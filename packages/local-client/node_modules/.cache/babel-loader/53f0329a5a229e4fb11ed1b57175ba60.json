{"ast":null,"code":"import _regeneratorRuntime from\"/Users/gleb/Desktop/study/react/ts-prod/ts-codepen/packages/local-client/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";import _asyncToGenerator from\"/Users/gleb/Desktop/study/react/ts-prod/ts-codepen/packages/local-client/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import*as esbuild from\"esbuild-wasm\";import{unpkgPathPlugin}from\"./plugins/UnpkgPathPlugin\";import{fetchPlugin}from\"./plugins/FetchPlugin\";var service;var bundle=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee(rawCode){var result;return _regeneratorRuntime().wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:if(service){_context.next=4;break;}_context.next=3;return esbuild.startService({worker:true,wasmURL:\"https://unpkg.com/esbuild-wasm@0.8.27/esbuild.wasm\"});case 3:service=_context.sent;case 4:_context.prev=4;_context.next=7;return service.build({entryPoints:[\"index.js\"],bundle:true,write:false,plugins:[unpkgPathPlugin(),fetchPlugin(rawCode)],define:{\"process.env.NODE_ENV\":'\"production\"',global:\"window\"},jsxFactory:\"_React.createElement\",jsxFragment:\"_React.Fragment\"});case 7:result=_context.sent;return _context.abrupt(\"return\",{code:result.outputFiles[0].text,error:\"\"});case 11:_context.prev=11;_context.t0=_context[\"catch\"](4);if(!(_context.t0 instanceof Error)){_context.next=17;break;}return _context.abrupt(\"return\",{code:\"\",error:_context.t0.message});case 17:throw _context.t0;case 18:case\"end\":return _context.stop();}}},_callee,null,[[4,11]]);}));return function bundle(_x){return _ref.apply(this,arguments);};}();export default bundle;","map":{"version":3,"names":["esbuild","unpkgPathPlugin","fetchPlugin","service","bundle","rawCode","startService","worker","wasmURL","build","entryPoints","write","plugins","define","global","jsxFactory","jsxFragment","result","code","outputFiles","text","error","Error","message"],"sources":["/Users/gleb/Desktop/study/react/ts-prod/ts-codepen/packages/local-client/src/bundler/index.ts"],"sourcesContent":["import * as esbuild from \"esbuild-wasm\";\nimport { unpkgPathPlugin } from \"./plugins/UnpkgPathPlugin\";\nimport { fetchPlugin } from \"./plugins/FetchPlugin\";\n\nlet service: esbuild.Service;\nconst bundle = async (rawCode: string) => {\n  if (!service) {\n    service = await esbuild.startService({\n      worker: true,\n      wasmURL: \"https://unpkg.com/esbuild-wasm@0.8.27/esbuild.wasm\",\n    });\n  }\n  try {\n    const result = await service.build({\n      entryPoints: [\"index.js\"],\n      bundle: true,\n      write: false,\n      plugins: [unpkgPathPlugin(), fetchPlugin(rawCode)],\n      define: {\n        \"process.env.NODE_ENV\": '\"production\"',\n        global: \"window\",\n      },\n      jsxFactory: \"_React.createElement\",\n      jsxFragment: \"_React.Fragment\",\n    });\n\n    return {\n      code: result.outputFiles[0].text,\n      error: \"\",\n    };\n  } catch (err) {\n    if (err instanceof Error)\n      return {\n        code: \"\",\n        error: err.message,\n      };\n    else {\n      throw err;\n    }\n  }\n};\n\nexport default bundle;\n"],"mappings":"4UAAA,MAAO,GAAKA,QAAO,KAAM,cAAc,CACvC,OAASC,eAAe,KAAQ,2BAA2B,CAC3D,OAASC,WAAW,KAAQ,uBAAuB,CAEnD,GAAIC,QAAwB,CAC5B,GAAMC,OAAM,4FAAG,iBAAOC,OAAe,kIAC9BF,OAAO,+CACMH,QAAO,CAACM,YAAY,CAAC,CACnCC,MAAM,CAAE,IAAI,CACZC,OAAO,CAAE,oDACX,CAAC,CAAC,QAHFL,OAAO,4DAMcA,QAAO,CAACM,KAAK,CAAC,CACjCC,WAAW,CAAE,CAAC,UAAU,CAAC,CACzBN,MAAM,CAAE,IAAI,CACZO,KAAK,CAAE,KAAK,CACZC,OAAO,CAAE,CAACX,eAAe,EAAE,CAAEC,WAAW,CAACG,OAAO,CAAC,CAAC,CAClDQ,MAAM,CAAE,CACN,sBAAsB,CAAE,cAAc,CACtCC,MAAM,CAAE,QACV,CAAC,CACDC,UAAU,CAAE,sBAAsB,CAClCC,WAAW,CAAE,iBACf,CAAC,CAAC,QAXIC,MAAM,+CAaL,CACLC,IAAI,CAAED,MAAM,CAACE,WAAW,CAAC,CAAC,CAAC,CAACC,IAAI,CAChCC,KAAK,CAAE,EACT,CAAC,iEAEG,sBAAeC,MAAK,2DACf,CACLJ,IAAI,CAAE,EAAE,CACRG,KAAK,CAAE,YAAIE,OACb,CAAC,iGAKN,kBAnCKnB,OAAM,4CAmCX,CAED,cAAeA,OAAM"},"metadata":{},"sourceType":"module"}